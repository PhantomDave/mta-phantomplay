{
  "name": "MTA PhantomPlay Development",
  "dockerComposeFile": ["../docker-compose.yml", "docker-compose.override.yml"],
  "service": "mta-server",
  "workspaceFolder": "/workspace",
  "shutdownAction": "stopCompose",

  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "installOhMyZsh": true,
      "installOhMyZshConfig": true,
      "upgradePackages": true
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.vscode-lua",
        "sumneko.lua",
        "formulahendry.code-runner",
        "ms-vscode.vscode-json",
        "redhat.vscode-yaml",
        "ms-vscode.vscode-xml",
        "streetsidesoftware.code-spell-checker",
        "eamodio.gitlens"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.cwd": "/workspace",
        "Lua.workspace.library": [
          "/opt/mta/mods/deathmatch/resources"
        ],
        "Lua.diagnostics.globals": [
          "addEvent",
          "addEventHandler",
          "triggerEvent",
          "triggerClientEvent",
          "triggerServerEvent",
          "outputChatBox",
          "outputConsole",
          "outputDebugString",
          "getPlayerName",
          "getPlayers",
          "createElement",
          "destroyElement",
          "setElementData",
          "getElementData",
          "exports",
          "resource",
          "resourceRoot",
          "root",
          "localPlayer",
          "source",
          "client",
          "mysql",
          "dbConnect",
          "dbQuery",
          "dbExec",
          "dbFree",
          "dbPoll"
        ]
      }
    }
  },

  "forwardPorts": [22003, 22126, 22005, 3306, 8080],
  "portsAttributes": {
    "22003": {
      "label": "MTA Server Game Port",
      "protocol": "udp"
    },
    "22126": {
      "label": "MTA Server HTTP Port"
    },
    "22005": {
      "label": "MTA Server ASE Port"
    },
    "3306": {
      "label": "MariaDB"
    },
    "8080": {
      "label": "phpMyAdmin"
    }
  },

  "postCreateCommand": "bash -c 'if [ -f /workspace/.devcontainer/setup.sh ]; then bash /workspace/.devcontainer/setup.sh; else echo \"Setup script not found, running basic setup...\"; sudo apt-get update && sudo apt-get install -y vim nano htop curl mysql-client; fi'",
  "postStartCommand": "bash -c 'if [ -f /workspace/.devcontainer/post-start.sh ]; then bash /workspace/.devcontainer/post-start.sh; fi'",

  "remoteUser": "mtauser",
  "containerEnv": {
    "MTA_DEV": "true",
    "DATABASE_HOST": "db",
    "DATABASE_PORT": "3306",
    "DATABASE_NAME": "mta_sa",
    "DATABASE_USER": "my_user",
    "DATABASE_PASSWORD": "user_password"
  }
}
