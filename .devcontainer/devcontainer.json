{
  "name": "MTA PhantomPlay Development",
  "dockerComposeFile": ["../docker-compose.yml"],
  "service": "mta-server",
  "workspaceFolder": "/opt/mta/mta-phantomplay",
  "shutdownAction": "stopCompose",

  "features": {
    "ghcr.io/devcontainers/features/git:1": {},
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installZsh": true,
      "configureZshAsDefaultShell": true,
      "installOhMyZsh": true,
      "installOhMyZshConfig": true,
      "upgradePackages": true
    }
  },

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-vscode.vscode-lua",
        "sumneko.lua",
        "formulahendry.code-runner",
        "ms-vscode.vscode-json",
        "redhat.vscode-yaml",
        "ms-vscode.vscode-xml",
        "streetsidesoftware.code-spell-checker",
        "eamodio.gitlens"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.cwd": "/opt/mta/mta-phantomplay",
        "Lua.workspace.library": ["/opt/mta/mta-phantomplay"],
        "Lua.diagnostics.globals": [
          "addEvent",
          "addEventHandler",
          "triggerEvent",
          "triggerClientEvent",
          "triggerServerEvent",
          "outputChatBox",
          "outputConsole",
          "outputDebugString",
          "getPlayerName",
          "getPlayers",
          "createElement",
          "destroyElement",
          "setElementData",
          "getElementData",
          "exports",
          "resource",
          "resourceRoot",
          "root",
          "localPlayer",
          "source",
          "client",
          "mysql",
          "dbConnect",
          "dbQuery",
          "dbExec",
          "dbFree",
          "dbPoll"
        ]
      }
    }
  },

  "forwardPorts": [22003, 22126, 22005, 3306, 8080],
  "portsAttributes": {
    "22003": {
      "label": "MTA Server Game Port",
      "protocol": "udp"
    },
    "22126": {
      "label": "MTA Server HTTP Port"
    },
    "22005": {
      "label": "MTA Server ASE Port"
    },
    "3306": {
      "label": "MariaDB"
    },
    "8080": {
      "label": "phpMyAdmin"
    }
  },

  "remoteUser": "root",
  "containerEnv": {
    "MTA_DEV": "true",
    "DATABASE_HOST": "db",
    "DATABASE_PORT": "3306",
    "DATABASE_NAME": "mta_sa",
    "DATABASE_USER": "my_user",
    "DATABASE_PASSWORD": "user_password"
  },

  "postAttachCommand": [
    "/bin/bash",
    "-c",
    "cd /opt/mta/multitheftauto_linux_x64 && rm -rf mods/deathmatch/resources/[gamemodes]/[phantomplay]/phantomplay mods/deathmatch/resources/[gamemodes]/[guieditor]/guieditor && mkdir -p mods/deathmatch/resources/[gamemodes]/[phantomplay] mods/deathmatch/resources/[gamemodes]/[guieditor] && ln -sf /opt/mta/mta-phantomplay/phantomplay mods/deathmatch/resources/[gamemodes]/[phantomplay]/phantomplay && ln -sf /opt/mta/mta-phantomplay/guieditor mods/deathmatch/resources/[gamemodes]/[guieditor]/guieditor && chown -h mtauser:mtauser mods/deathmatch/resources/[gamemodes]/[phantomplay]/phantomplay mods/deathmatch/resources/[gamemodes]/[guieditor]/guieditor && echo 'Successfully created symlinks for phantomplay and guieditor resources'"
  ]
}
